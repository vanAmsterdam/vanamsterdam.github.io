{
  "hash": "782429369e8b952329968198bfce35f1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Finding the functional form for multiple linear regression\noutput: pdf_document\ndate: '2019/08/16'\ndate-modified: \"2024/03/22\"\ncategories:\n- statistics \n- simulations\n- linear regression\n---\n\n\n## Functional relationship in linear regression\n\nA frequent question that comes up when modeling continuous outcomes with multiple linear regression \nis what the correct functional form for the relationship between the independent variables is.\nTLDR: the answer is a [partial residual plot](https://en.wikipedia.org/wiki/Partial_residual_plot). \nHere I will generate some data to illustrate this\n\n## Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressMessages({require(ggplot2); theme_set(theme_bw())})\nset.seed(12345)\nN = 1000\nx <- runif(N, min = 0, max=2*pi)\nw <- .5*x + sin(x) + rnorm(N, sd=.25)\nsy <- rnorm(N, sd=.1)\ny <- x + w + sy\ndf = data.frame(x,w,y)\n```\n:::\n\n\n\nThe data consists of two real-valued 'independent' variables $x,w$, \nwhere \n\n$$\n\\begin{align}\nx &\\sim U(0, 2 \\pi) \\\\\n\\epsilon_w &\\sim N(0, 0.25) \\\\\n\\epsilon_y &\\sim N(0, 0.1) \\\\\nw &:= \\frac{x}{2} + \\sin(x) \\\\\ny &:= x + w + \\epsilon_y\n\\end{align}\n$$\n\nClearly $y$ is linear in both $x$ and $w$.\nA plot of the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x=x, y=w,col=y, size=y)) + \n  geom_point() + theme_minimal()\n```\n\n::: {.cell-output-display}\n![joint distribution of x, w, y](190816-lm-functional-form_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Plots\n\n### Incorrect: marginal association\n\n\nLet's say we're particularly interested in the relationship between $y$ and $x$, both conditional on $w$.\nLooking at the *marginal* association between $y$ and $x$ with a scatterplot will set us on the wrong foot, \nbecause of the association between $x$ and $w$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x=x,y=y)) + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![marginal association between x and y](190816-lm-functional-form_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Correct: partial residual plot\n\nTo construct the correct plot, we can generate a partial residual plot, which is created with `resid(lm(y~x+w))+b_x x ~ x`.\n\nWhere `b_x` is the regression coefficient found through linear regression of $y$ on $x$ and $w$.\nIn a plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmfit <- lm(y~x+w)\nyresid <- resid(lmfit)\nb_x <- coef(lmfit)['x']\nplotdata <- data.frame(x, y=yresid + b_x * x)\n\nggplot(plotdata, aes(x=x,y=y)) + \n  geom_point() + \n  ylab(\"resid(lm(y~x+w)) + b_x x\")\n```\n\n::: {.cell-output-display}\n![partial residual plot](190816-lm-functional-form_files/figure-html/fig-partialresid-1.png){#fig-partialresid width=672}\n:::\n:::\n\n\n### Partial residual plot when y is not linear in x\n\nWhat if $y$ were not linear in $x$?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ny2 <- x^2 + w + sy\nlmfit2 <- lm(y2 ~ x + w)\nb_x2 <- coef(lmfit2)['x']\nplotdata2 <- data.frame(x, y=resid(lmfit2) + b_x2 * x)\n\nggplot(plotdata2, aes(x=x,y=y)) + \n  geom_point() + \n  ylab(\"resid(lm(y~x+w)) + b_x x\")\n```\n\n::: {.cell-output-display}\n![partial residual plot when y not linear in x](190816-lm-functional-form_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Conclusion\n\nThe functional relationship between an outcome and a covariate in a linear regression conditional on other covariates is visualized with a [partial residual plot](https://en.wikipedia.org/wiki/Partial_residual_plot), or:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmfit <- lm(y~x+w)\nplot(resid(lmfit) + coef(lmfit)['x'] * x ~ x)\n```\n:::\n",
    "supporting": [
      "190816-lm-functional-form_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}