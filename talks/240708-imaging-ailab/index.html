<!DOCTYPE html>
<html lang="en"><head>
<link href="../../wva.png" rel="icon" type="image/png">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-contrib/bootstrap-icons-1.11.1/all.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.30">

  <meta name="author" content="Wouter van Amsterdam">
  <meta name="dcterms.date" content="2024-07-08">
  <title>Wouter van Amsterdam – Medical imaging and AI for decision support</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-be51df28a2a48809041d03b0f324d756.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-E4W5XMDCR7"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-E4W5XMDCR7', { 'anonymize_ip': true});
  </script>
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Medical imaging and AI for decision support – Wouter van Amsterdam">
<meta property="og:description" content="Medical Imaging AI lab meeting">
<meta property="og:site_name" content="Wouter van Amsterdam">
<meta name="twitter:title" content="Medical imaging and AI for decision support – Wouter van Amsterdam">
<meta name="twitter:description" content="Medical Imaging AI lab meeting">
<meta name="twitter:site" content="@wvanamsterdam">
<meta name="twitter:card" content="summary">
</head>
<body class="quarto-light">
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {enableAssistiveMml: false}});</script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Medical imaging and AI for decision support</h1>
  <p class="subtitle">Medical Imaging AI lab meeting</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="https://vanamsterdam.github.io">Wouter van Amsterdam</a> 
</div>
        <p class="quarto-title-affiliation">
            Department of Data Science Methods, Julius Center, University Medical Center Utrecht
          </p>
    </div>
</div>

  <p class="date">2024-07-08</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/uses-of-ai-in-medical-imaging" id="/toc-uses-of-ai-in-medical-imaging">Uses of AI in medical imaging</a></li>
<li><a href="#/selffulfilling" id="/toc-selffulfilling">When accurate prediction models yield harmful self-fulfilling prophecies</a></li>
<li><a href="#/building-and-validating-models-for-decision-support" id="/toc-building-and-validating-models-for-decision-support">Building and validating models for decision support</a></li>
</ul>
</nav>
</section>
<section>
<section id="uses-of-ai-in-medical-imaging" class="title-slide slide level1 center">
<h1>Uses of AI in medical imaging</h1>

</section>
<section id="use-ai-for-medical-imaging" class="slide level2 center">
<h2>Use AI for medical imaging</h2>
<h3 id="to-make-healthcare-easier-or-more-efficient">to make healthcare easier or more efficient</h3>
<ol type="1">
<li><p>Acquisition (<span class="math inline">\(S \to X\)</span>)</p>
<div class="fragment">
<ul>
<li>k-space to MRI image</li>
<li>raw projection data to CT image</li>
</ul>
</div></li>
<li><p>detection / segmentation (<span class="math inline">\(X \to X\)</span>)</p>
<div class="fragment">
<ul>
<li>segmenting organs at risk in radiotherapy</li>
</ul>
</div></li>
<li><p>inference / diagnosis (<span class="math inline">\(X \to D\)</span>, both at prediction time)</p>
<div class="fragment">
<ul>
<li>medical diagnosis</li>
<li>psuedo CT from MRI</li>
</ul>
</div></li>
</ol>
</section>
<section id="use-ai-for-medical-imaging-1" class="slide level2 center">
<h2>Use AI for medical imaging</h2>
<h3 id="to-make-healthcare-better-improve-decisions">to make healthcare better (improve decisions)</h3>
<ol start="4" type="1">
<li><p>prognosis (<span class="math inline">\(X \to Y\)</span>, <span class="math inline">\(Y\)</span> in the future)</p>
<div class="fragment">
<ul>
<li>expected survival time given CT-scan</li>
</ul>
</div></li>
<li><p>treatment effect (<span class="math inline">\(X\)</span> determines effect of a treatment <span class="math inline">\(T\)</span> on outcome <span class="math inline">\(Y\)</span> in the future)</p></li>
</ol>
<!--
   :::{.fragment}
   ::::{.nonincremental}
   - effect of immunotherapy given T-cell distribution around tumor
   - heterogeneity of tumor on CT may predict response to radiotherapy
   - patient 
   ::::
   :::
-->
</section>
<section id="ai-treatment-effect" class="slide level2 center">
<h2>Why would you estimate treatment effects based on images?</h2>
<!-- TODO: make examples figures instead of text -->
<ul>
<li>treatments have different effects on patients based on their (disease) characteristics</li>
<li>for example, whether tamoxifen increases survival for breast cancer patients depends on whether their tumor is hormone sensitive</li>
<li>some characteristics may be well captured in medical imaging:
<ul>
<li>T-cell distributions around tumors related to effect of immunotherapy in cancer</li>
<li>heterogeneity of tumor on CT may predict response to radiotherapy</li>
<li>holistic view of ‘body composition’ on CT-scans determines whether patient can tolerate chemotherapy</li>
</ul></li>
</ul>
</section>
<section id="how-to-estimate-treatment-effects-based-on-images" class="slide level2 center">
<h2>How to estimate treatment effects based on images?</h2>
<!-- TODO: have mulitple steps in point 4 to build it up -->
<p>In principle the same as estimating a subgroup treatment effect (e.g.&nbsp;male vs female)</p>
<ol type="1">
<li>Conduct a randomized controlled trial where the treatments of interest are randomly allocated</li>
<li>Collect (imaging) data at randomization timepoint</li>
<li>Use a statistical learning technique like TARnet <span class="citation" data-cites="shalitEstimatingIndividualTreatment2017">(<a href="#/references" role="doc-biblioref" onclick="">Shalit, Johansson, and Sontag 2017</a>)</span> to estimate outcomes conditional on image and treatment</li>
<li>conditional treatment effect <span class="math inline">\(= f(X,T=1) - f(X,T=0)\)</span></li>
</ol>
<div class="fragment">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>What if you cannot do a (big enough) RCT?</strong></p>
</div>
<div class="callout-content">
<p>Emulate / approximate the ideal trial in observational data you do have, using <strong>causal inference</strong> techniques</p>
<p><strong>(which rely on untestable assumptions)</strong></p>
</div>
</div>
</div>
</div>
</section>
<section id="improving-decisions-with-ai" class="slide level2 center">
<h2>Improving decisions with AI</h2>
<ol start="4" type="1">
<li>prognosis (<span class="math inline">\(X \to Y\)</span>, <span class="math inline">\(Y\)</span> in the future)</li>
<li>treatment effect (<span class="math inline">\(X\)</span> determines effect of a treatment <span class="math inline">\(T\)</span> on outcome <span class="math inline">\(Y\)</span> in the future)</li>
</ol>
<ul>
<li>Whereas treatment effect estimation is typically thought of as a <em>causal</em> task requiring <em>causal</em> approaches (e.g.&nbsp;randomized controllerd trials)</li>
<li>Prognosis models are often developed without any causal thinking (if it predicts it predicts)</li>
<li>but then advertised for making treatment decisions.</li>
</ul>
</section>
<section id="the-in-between-using-prediction-models-for-medical-decision-making" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">The in-between: using prediction models for (medical) decision making</h2>
<ul>
<li>prognosis (e.g.&nbsp;survival given medical image)</li>
</ul>

<img data-src="figs/8q8oy7_meme_crossover.jpg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="using-prediction-models-for-decision-making-is-often-thought-of-as-a-good-idea" class="slide level2 center">
<h2>Using prediction models for decision making is often thought of as a good idea</h2>
<p>For example:</p>
<ol type="1">
<li>give chemotherapy to cancer patients with high predicted risk of recurrence</li>
<li>give statins to patients with a high risk of a heart attack</li>
</ol>
<div class="fragment">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>TRIPOD+AI on prediction models <span class="citation" data-cites="collinsTRIPODAIStatement2024">(<a href="#/references" role="doc-biblioref" onclick=""><strong>collinsTRIPODAIStatement2024?</strong></a>)</span></strong></p>
</div>
<div class="callout-content">
<p>“Their primary use is to support clinical decision making, such as … <strong>initiate treatment or lifestyle changes.</strong>”</p>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2 center">

<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>This may lead to bad situations when:</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>ignoring the treatments patients may have had during training / validation of (AI) prediction model</li>
<li>only considering measures of predictive accuracy as sufficient evidence for safe deployment</li>
</ol>
</div>
</div>
</div>
</section></section>
<section>
<section id="selffulfilling" class="title-slide slide level1 center">
<h1>When accurate prediction models yield harmful self-fulfilling prophecies</h1>

</section>
<section class="slide level2 center">

<div class="r-stack">
<p><img data-src="figs/rt_example1.png" class="fragment" style="height:24cm"></p>
<p><img data-src="figs/rt_example2.png" class="fragment" style="height:24cm"></p>
<p><img data-src="figs/rt_example3.png" class="fragment" style="height:24cm"></p>
<p><img data-src="figs/rt_example4.png" class="fragment" style="height:24cm"></p>
<p><img data-src="figs/rt_example5.png" class="fragment" style="height:24cm"></p>
<p><img data-src="figs/rt_example6.png" class="fragment" style="height:24cm"></p>
<p><img data-src="figs/rt_example.png" class="fragment" style="height:24cm"></p>
</div>
</section>
<section id="building-models-for-decision-support-without-regards-for-the-historic-treatment-policy-is-a-bad-idea" class="slide level2 center">
<h2>Building models for decision support without regards for the historic treatment policy is a bad idea</h2>
<div class="r-stack">
<p><img data-src="figs/policy_changea1.png" class="fragment" style="width:100.0%"></p>
<p><img data-src="figs/policy_changea3.png" class="fragment" style="width:100.0%"></p>
<p><img data-src="figs/policy_changeax.png" class="fragment" style="width:100.0%"></p>
<p><img data-src="figs/policy_changeb2.png" class="fragment" style="width:100.0%"></p>
<p><img data-src="figs/policy_changebx.png" class="fragment" style="width:100.0%"></p>
</div>
</section>
<section class="slide level2 center">

<p><span class="r-fit-text">The question is not “is my model accurate before / after deployment”,</span></p>
<p><span class="r-fit-text fragment">but did deploying the model improve patient outcomes?</span></p>
</section>
<section id="treatment-naive-prediction-models" class="slide level2 center">
<h2>Treatment-naive prediction models</h2>
<div class="r-stack">
<p><img data-src="figs/txnaive1.png"></p>
<p><img data-src="figs/txnaive2b.png" class="fragment"></p>
</div>
<p><span class="math display">\[\begin{align}
    E[Y|X] \class{fragment}{= E[E_{t~\sim \pi_0(X)}[Y|X,t]]}
\end{align}\]</span></p>
</section>
<section id="treatment-naive-prediction-models-1" class="slide level2 center">
<h2>Treatment-naive prediction models</h2>
<p><span class="citation" data-cites="vanamsterdamWhenAccuratePrediction2024">(Results from <a href="#/references" role="doc-biblioref" onclick="">W. A. C. van Amsterdam, van Geloven, et al. 2024</a>)</span></p>
<ol type="1">
<li>good or bad discrimination post deployment may be a sign of a harmful or a beneficial policy change</li>
<li>models that are perfectly calibrated before and after deployment are certainly not useful for decision making because they didn’t change the distribution</li>
</ol>
</section>
<section class="slide level2 center">

<p><span class="r-fit-text">Is this obvious?</span></p>
<!--::: {.callout-tip}-->
<!--It may seem obvious that you should not ignore historical treatments in your prediction models, if you want to improve treatment decisions, but many of these models are published daily, and some guidelines even allow for implementing these models based on predictve performance only-->
<!--:::-->
</section>
<section id="prediction-modeling-is-very-popular-in-medical-research" class="slide level2 center">
<h2>Prediction modeling is very popular in medical research</h2>

<img data-src="figs/predmodelsoverview.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="recommended-validation-practices-and-reporting-guidelines-do-not-protect-against-harm" class="slide level2 center">
<h2>Recommended validation practices and reporting guidelines do not protect against harm</h2>
<h3 id="because-they-do-not-evaluate-the-policy-change">because they do not evaluate the policy change</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/ajcc_title.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/tripod_ai.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</section>
<section id="bigger-data-does-not-protect-against-harmful-prediction-models" class="slide level2 center">
<h2>Bigger data does not protect against harmful prediction models</h2>

<img data-src="figs/biggerdata.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="more-flexible-models-do-not-protect-against-harmful-prediction-models" class="slide level2 center">
<h2>More flexible models do not protect against harmful prediction models</h2>

<!-- TODO make mindthegap background image -->
<img data-src="figs/morelayers.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section class="slide level2 center">


<img data-src="figs/mindthegap.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="section" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title"></h2>
<div style="margin-top: 200px; font-size: 3em; color: red;">
<p>What to do?</p>
</div>
</section>
<section id="section-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title"></h2>
<div style="margin-top: 100px">
<p>What to do?</p>
</div>
<ol type="1">
<li>Evaluate policy change (cluster randomized controlled trial)</li>
<li>Build models that are likely to have value for decision making</li>
</ol>
</section></section>
<section>
<section id="building-and-validating-models-for-decision-support" class="title-slide slide level1 center">
<h1>Building and validating models for decision support</h1>

</section>
<section id="deploying-a-model-is-an-intervention-that-changes-the-way-treatment-decisions-are-made" class="slide level2 center">
<h2>Deploying a model is an intervention that changes the way treatment decisions are made</h2>

<img data-src="figs/policy_changebx.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="how-do-we-learn-about-the-effect-of-an-intervention" class="slide level2 center">
<h2>How do we learn about the effect of an intervention?</h2>
<p>With a randomized experiment</p>
<!--With causal inference!-->
<ul>
<li>for using a decision support model, the unit of intervention is usually <em>the doctor</em></li>
<li>randomly assign <em>doctors</em> to have access to the model or not</li>
<li>measure differences in <strong>treatment decisions</strong> and <strong>patient outcomes</strong></li>
<li>this called a cluster RCT</li>
<li>if using model improves outcomes, use that one</li>
</ul>
<div class="fragment">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Using cluster RCTs to evaluated models for decision making is not a new idea <span class="citation" data-cites="cooperEvaluationMachinelearningMethods1997">(<a href="#/references" role="doc-biblioref" onclick="">Cooper et al. 1997</a>)</span></strong></p>
</div>
<div class="callout-content">
<p>“As one possibility, suppose that a trial is performed in which clinicians are randomized either to have or not to have access to such a decision aid in making decisions about where to treat patients who present with pneumonia.”</p>
</div>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>What we don’t learn</strong></p>
</div>
<div class="callout-content">
<p>was the model predicting anything sensible?</p>
</div>
</div>
</div>
</div>
</section>
<section id="so-build-treatment-naive-prediction-models-and-trial-them-for-decision-support" class="slide level2 center">
<h2>So build treatment-naive prediction models and trial them for decision support?</h2>
<p>Not a good idea</p>
<ul>
<li>baking a cake without a recipe</li>
<li>hoping it turns into something nice</li>
<li>not pleasant to people that need to taste result of the experiment
<ul>
<li>(i.e.&nbsp;patients may have side-effects / die)</li>
</ul></li>
</ul>
</section>
<section id="we-should-build-models-that-are-likely-to-be-valuable-for-decision-making" class="slide level2 center">
<h2>We should build models that are likely to be valuable for decision making</h2>
<ul>
<li>Build models that predict expected outcomes under <em>hypothetical interventions</em> (<em>prediction-under-intervention models</em>)</li>
<li>doctor / patient can pick the treatment with <em>best</em> expected outcomes, depending on patient’s values and preferences</li>
<li>whereas <em>treatment-naive</em> prediction models average out over the historic treatment policy, prediction-under-intervention allows the user to select a treatment option</li>
</ul>
<div class="fragment">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Hilden and Habbema on prognosis <span class="citation" data-cites="hildenPrognosisMedicineAnalysis1987">(<a href="#/references" role="doc-biblioref" onclick="">Hilden and Habbema 1987</a>)</span></strong></p>
</div>
<div class="callout-content">
<p>“Prognosis cannot be divorced from contemplated medical action, nor from action to be taken by the patient in response to prognostication.”</p>
</div>
</div>
</div>
<ul>
<li>prediction-under-intervention is not a new idea, but language and methods on causality have come a long way since <span class="citation" data-cites="hildenPrognosisMedicineAnalysis1987">(<a href="#/references" role="doc-biblioref" onclick="">Hilden and Habbema 1987</a>)</span>.</li>
</ul>
</div>
</section>
<section id="estimand-for-prediction-under-intervention-models" class="slide level2 center">
<h2>Estimand for prediction-under-intervention models</h2>
<p>What is the estimand?</p>
<ul>
<li>prediction: <span class="math inline">\(E[Y|X]\)</span></li>
<li>average treatment effect: <span class="math inline">\(E[Y|\text{do}(T=1)] - E[Y|\text{do}(T=0)]\)</span></li>
<li>conditional average treatment effect: <span class="math inline">\(E[Y|\text{do}(T=1),X] - E[Y|\text{do}(T=0),X]\)</span></li>
<li>prediction-under-intervention: <span class="math inline">\(E[Y|\text{do}(T=t),X]\)</span></li>
</ul>
</section>
<section class="slide level2 center">

<div class="columns">
<div class="column" style="width:50%;">
<p>using <em>treatment naive</em> prediction models for decision support</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/8q8oy7_meme_crossover.jpg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div><div class="column" style="width:50%;">
<p>prediction-under-intervention</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/peanutbutter_chocolatesprinkles.jpg" class="fragment quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div></div>
</section>
<section id="more-on-prediction-under-intervention-models" class="slide level2 center">
<h2>More on prediction-under-intervention models</h2>
<p>development:</p>
<ul>
<li>ideally estimated from RCTs, but these are often too small or don’t measure the right data</li>
<li>alternatively can use observational data and causal inference methods</li>
<li>assumption of no unobserved confounding often hard to justify in observational data</li>
<li>but there’s more between heaven (RCT) and earth (confounder adjustment)
<ul>
<li>proxy-variable methods <span class="citation" data-cites="miaoIdentifyingCausalEffects2018 vanamsterdamIndividualTreatmentEffect2022">(e.g. <a href="#/references" role="doc-biblioref" onclick="">Miao, Geng, and Tchetgen Tchetgen 2018</a>; <a href="#/references" role="doc-biblioref" onclick="">Wouter A. C. van Amsterdam et al. 2022</a>)</span></li>
<li>constant relative treatment effect assumption <span class="citation" data-cites="alaaMachineLearningGuide2021 vanamsterdamConditionalAverageTreatment2023 candidodosreisUpdatedPREDICTBreast2017">(e.g. <a href="#/references" role="doc-biblioref" onclick="">Alaa et al. 2021</a>; <a href="#/references" role="doc-biblioref" onclick="">Wouter A. C. van Amsterdam and Ranganath 2023</a>; <a href="#/references" role="doc-biblioref" onclick="">Candido dos Reis et al. 2017</a>)</span></li>
<li>diff-in-diff</li>
<li>instrumental variable analysis <span class="citation" data-cites="waldFittingStraightLines1940 puliGeneralControlFunctions2021 hartfordDeepIVFlexible2017">(<a href="#/references" role="doc-biblioref" onclick="">Wald 1940</a>; <a href="#/references" role="doc-biblioref" onclick="">Puli and Ranganath 2021</a>; <a href="#/references" role="doc-biblioref" onclick="">Hartford et al. 2017</a>)</span></li>
<li>front-door analysis</li>
</ul></li>
<li>many of these have potential new applications with AI and medical imaging</li>
</ul>
</section>
<section id="evaluation-of-prediction-under-intervention-models" class="slide level2 center">
<h2>Evaluation of prediction-under-intervention models</h2>
<ul>
<li>prediction accuracy can be tested in RCTs, or in observational data with specialized methods accounting for confounding <span class="citation" data-cites="keoghPredictionInterventionsEvaluation2024">(e.g. <a href="#/references" role="doc-biblioref" onclick="">Keogh and van Geloven 2024</a>)</span></li>
<li>in confounded observational data, typical metrics (e.g.&nbsp;AUC or calibration) are not sufficient as we want to predict well in data from <em>other distribution than observed data</em> (i.e.&nbsp;other treatment decisions)</li>
<li>a new <em>policy</em> can be evaluated in historic RCTs <span class="citation" data-cites="karmaliBloodPressureloweringTreatment2018">(e.g. <a href="#/references" role="doc-biblioref" onclick="">Karmali et al. 2018</a>)</span></li>
<li>ultimate test is cluster RCT</li>
<li>if not perfect, likely a better recipe than <em>treatment-naive</em> models</li>
</ul>
</section>
<section id="take-aways" class="slide level2 center">
<h2>Take-aways</h2>
<ul>
<li>deploying models for decision support is an intervention and should be evaluated as such</li>
<li>when developing or evaluating (AI) prediction models for medical decisions, think about
<ul>
<li>what is the effect of using this model on medical decisions?</li>
<li>what is the effect of this policy change on patient outcomes?</li>
</ul></li>
<li>prediction-under-intervention models have a foreseeable effect on patient oucomes when used for decision making</li>
</ul>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/qr_comment.png" class="quarto-figure quarto-figure-center" style="height:6cm"></p>
</figure>
</div>
<p>From algorithms to action: improving patient care requires causality <span class="citation" data-cites="vanamsterdamAlgorithmsActionImproving2024">(<a href="#/references" role="doc-biblioref" onclick="">W. A. C. van Amsterdam, Jong, et al. 2024</a>)</span></p>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/qr_selffulfilling.png" class="quarto-figure quarto-figure-center" style="height:6cm"></p>
</figure>
</div>
<p>When accurate prediction models yield harmful sel-fulfilling prophecies <span class="citation" data-cites="vanamsterdamWhenAccuratePrediction2024">(<a href="#/references" role="doc-biblioref" onclick="">W. A. C. van Amsterdam, van Geloven, et al. 2024</a>)</span></p>
</div></div>
</div>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-alaaMachineLearningGuide2021" class="csl-entry" role="listitem">
Alaa, Ahmed M., Deepti Gurdasani, Adrian L. Harris, Jem Rashbass, and Mihaela van der Schaar. 2021. <span>“Machine Learning to Guide the Use of Adjuvant Therapies for Breast Cancer.”</span> <em>Nature Machine Intelligence</em>, June, 1–11. <a href="https://doi.org/10/gk6bh7">https://doi.org/10/gk6bh7</a>.
</div>
<div id="ref-candidodosreisUpdatedPREDICTBreast2017" class="csl-entry" role="listitem">
Candido dos Reis, Francisco J., Gordon C. Wishart, Ed M. Dicks, David Greenberg, Jem Rashbass, Marjanka K. Schmidt, Alexandra J. van den Broek, et al. 2017. <span>“An Updated <span>PREDICT</span> Breast Cancer Prognostication and Treatment Benefit Prediction Model with Independent Validation.”</span> <em>Breast Cancer Research</em> 19 (1): 58. <a href="https://doi.org/10/gbhgpq">https://doi.org/10/gbhgpq</a>.
</div>
<div id="ref-cooperEvaluationMachinelearningMethods1997" class="csl-entry" role="listitem">
Cooper, Gregory F., Constantin F. Aliferis, Richard Ambrosino, John Aronis, Bruce G. Buchanan, Richard Caruana, Michael J. Fine, et al. 1997. <span>“An Evaluation of Machine-Learning Methods for Predicting Pneumonia Mortality.”</span> <em>Artificial Intelligence in Medicine</em> 9 (2): 107–38. <a href="https://doi.org/10.1016/S0933-3657(96)00367-3">https://doi.org/10.1016/S0933-3657(96)00367-3</a>.
</div>
<div id="ref-hartfordDeepIVFlexible2017" class="csl-entry" role="listitem">
Hartford, Jason, Greg Lewis, Kevin Leyton-Brown, and Matt Taddy. 2017. <span>“Deep <span>IV</span>: <span>A Flexible Approach</span> for <span>Counterfactual Prediction</span>.”</span> In <em>International <span>Conference</span> on <span>Machine Learning</span></em>, 1414–23. PMLR.
</div>
<div id="ref-hildenPrognosisMedicineAnalysis1987" class="csl-entry" role="listitem">
Hilden, Jørgen, and J. Dik F. Habbema. 1987. <span>“Prognosis in Medicine: <span>An</span> Analysis of Its Meaning and r<span>ô</span>les.”</span> <em>Theoretical Medicine</em> 8 (3): 349–65. <a href="https://doi.org/10.1007/BF00489469">https://doi.org/10.1007/BF00489469</a>.
</div>
<div id="ref-karmaliBloodPressureloweringTreatment2018" class="csl-entry" role="listitem">
Karmali, Kunal N., Donald M. Lloyd-Jones, Joep van der Leeuw, David C. Goff Jr, Salim Yusuf, Alberto Zanchetti, Paul Glasziou, et al. 2018. <span>“Blood Pressure-Lowering Treatment Strategies Based on Cardiovascular Risk Versus Blood Pressure: <span>A</span> Meta-Analysis of Individual Participant Data.”</span> <em>PLOS Medicine</em> 15 (3): e1002538. <a href="https://doi.org/10.1371/journal.pmed.1002538">https://doi.org/10.1371/journal.pmed.1002538</a>.
</div>
<div id="ref-keoghPredictionInterventionsEvaluation2024" class="csl-entry" role="listitem">
Keogh, Ruth H., and Nan van Geloven. 2024. <span>“Prediction Under Interventions: Evaluation of Counterfactual Performance Using Longitudinal Observational Data.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2304.10005">https://doi.org/10.48550/arXiv.2304.10005</a>.
</div>
<div id="ref-miaoIdentifyingCausalEffects2018" class="csl-entry" role="listitem">
Miao, Wang, Zhi Geng, and Eric J Tchetgen Tchetgen. 2018. <span>“Identifying Causal Effects with Proxy Variables of an Unmeasured Confounder.”</span> <em>Biometrika</em> 105 (4): 987–93. <a href="https://doi.org/10.1093/biomet/asy038">https://doi.org/10.1093/biomet/asy038</a>.
</div>
<div id="ref-puliGeneralControlFunctions2021" class="csl-entry" role="listitem">
Puli, Aahlad Manas, and Rajesh Ranganath. 2021. <span>“General <span>Control Functions</span> for <span>Causal Effect Estimation</span> from <span>Instrumental Variables</span>.”</span> <em>arXiv:1907.03451 [Cs, Stat]</em>, February. <a href="https://arxiv.org/abs/1907.03451">https://arxiv.org/abs/1907.03451</a>.
</div>
<div id="ref-shalitEstimatingIndividualTreatment2017" class="csl-entry" role="listitem">
Shalit, Uri, Fredrik D. Johansson, and David Sontag. 2017. <span>“Estimating Individual Treatment Effect: Generalization Bounds and Algorithms.”</span> <em>arXiv:1606.03976 [Cs, Stat]</em>, May. <a href="https://arxiv.org/abs/1606.03976">https://arxiv.org/abs/1606.03976</a>.
</div>
<div id="ref-vanamsterdamAlgorithmsActionImproving2024" class="csl-entry" role="listitem">
van Amsterdam, W. A. C., Pim A. de Jong, Joost J. C. Verhoeff, Tim Leiner, and Rajesh Ranganath. 2024. <span>“From Algorithms to Action: Improving Patient Care Requires Causality.”</span> <em>BMC Medical Informatics and Decision Making</em> 24 (1). <a href="https://doi.org/10.1186/s12911-024-02513-3">https://doi.org/10.1186/s12911-024-02513-3</a>.
</div>
<div id="ref-vanamsterdamWhenAccuratePrediction2024" class="csl-entry" role="listitem">
van Amsterdam, W. A. C., Nan van Geloven, Jesse H. Krijthe, Rajesh Ranganath, and Giovanni Ciná. 2024. <span>“When Accurate Prediction Models Yield Harmful Self-Fulfilling Prophecies.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2312.01210">https://doi.org/10.48550/arXiv.2312.01210</a>.
</div>
<div id="ref-vanamsterdamConditionalAverageTreatment2023" class="csl-entry" role="listitem">
van Amsterdam, Wouter A. C., and Rajesh Ranganath. 2023. <span>“Conditional Average Treatment Effect Estimation with Marginally Constrained Models.”</span> <em>Journal of Causal Inference</em> 11 (1): 20220027. <a href="https://doi.org/10.1515/jci-2022-0027">https://doi.org/10.1515/jci-2022-0027</a>.
</div>
<div id="ref-vanamsterdamIndividualTreatmentEffect2022" class="csl-entry" role="listitem">
van Amsterdam, Wouter A. C., Joost J. C. Verhoeff, Netanja I. Harlianto, Gijs A. Bartholomeus, Aahlad Manas Puli, Pim A. de Jong, Tim Leiner, Anne S. R. van Lindert, Marinus J. C. Eijkemans, and Rajesh Ranganath. 2022. <span>“Individual Treatment Effect Estimation in the Presence of Unobserved Confounding Using Proxies: A Cohort Study in Stage <span>III</span> Non-Small Cell Lung Cancer.”</span> <em>Scientific Reports</em> 12 (1): 5848. <a href="https://doi.org/10.1038/s41598-022-09775-9">https://doi.org/10.1038/s41598-022-09775-9</a>.
</div>
<div id="ref-waldFittingStraightLines1940" class="csl-entry" role="listitem">
Wald, Abraham. 1940. <span>“The <span>Fitting</span> of <span>Straight Lines</span> If <span>Both Variables</span> Are <span>Subject</span> to <span>Error</span>.”</span> <em>The Annals of Mathematical Statistics</em> 11 (3): 284–300. <a href="https://doi.org/10.1214/aoms/1177731868">https://doi.org/10.1214/aoms/1177731868</a>.
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="umcu_blue.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>©Wouter van Amsterdam — <i class="bi-twitter-x " style="" role="img" aria-hidden="true"></i> WvanAmsterdam — <i class="bi-file-slides " style="" role="img" aria-hidden="true"></i> wvanamsterdam.com/talks</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/vanamsterdam\.github\.io");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>